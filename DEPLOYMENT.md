# Deployment Guide

This guide explains how to deploy the Citizen Grievance Portal to Railway or Render for free.

## Prerequisites

1. A GitHub account
2. Your code pushed to GitHub
3. An account on Render.com or Railway.app

## Deployment Steps

### Option 1: Deploy to Render (Recommended)

1. **Push to GitHub**
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git remote add origin https://github.com/YOUR_USERNAME/YOUR_REPO.git
   git push -u origin main
   ```

2. **Create Render Account**
   - Visit https://dashboard.render.com
   - Sign up with your GitHub account

3. **Create New Service**
   - Click "New +" → "Web Service"
   - Connect your GitHub repository
   - Render will auto-detect `render.yaml` configuration

4. **Configure Environment**
   - Render will automatically create a PostgreSQL database
   - Set additional environment variables if needed:
     - `DATABASE_URL` - Auto-configured by Render
     - `SESSION_SECRET` - Auto-generated by Render

5. **Deploy**
   - Click "Create Web Service"
   - Render will build and deploy automatically
   - Your app will be live at `your-app.onrender.com`

### Option 2: Deploy to Railway

1. **Push to GitHub** (same as above)

2. **Create Railway Account**
   - Visit https://railway.app
   - Sign up with your GitHub account

3. **Create New Project**
   - Click "New Project" → "Deploy from GitHub repo"
   - Select your repository

4. **Add PostgreSQL**
   - Click "+ Add" → Select "PostgreSQL"
   - Railway will create a database automatically

5. **Configure Environment Variables**
   - Go to Variables tab
   - Add these variables:
     - `NODE_ENV`: `production`
     - `DATABASE_URL`: Railway auto-populates this
     - `SESSION_SECRET`: Generate a random string and paste it

6. **Deploy**
   - Click "Deploy"
   - Railway will build and deploy automatically
   - Your app will be live at a railway.app domain

## Environment Variables

The app requires these environment variables:

| Variable | Description | Example |
|----------|-------------|---------|
| `DATABASE_URL` | PostgreSQL connection string | `postgresql://user:pass@host/db` |
| `SESSION_SECRET` | Secret for session encryption | Any random 32+ character string |
| `NODE_ENV` | Environment mode | `production` |
| `PORT` | Server port | `5000` |

## First Run Setup

After deployment, the database schema needs to be initialized:

1. **For Render**: Database is auto-migrated on first deploy
2. **For Railway**: Run migrations manually:
   ```
   npm run db:push
   ```

## Troubleshooting

**App crashes on startup:**
- Check logs in the deployment platform dashboard
- Ensure `DATABASE_URL` is set correctly
- Verify `SESSION_SECRET` is defined

**Database not connecting:**
- Wait 1-2 minutes for database to be fully provisioned
- Check DATABASE_URL format is correct
- For Railway, manually run `npm run db:push` in console

**Free tier limitations:**
- Render: Spins down after 15 minutes of inactivity (takes ~30s to wake)
- Railway: ~5GB bandwidth per month
- Database: Both offer free PostgreSQL databases

## Monitoring & Support

- **Render**: Dashboard at https://dashboard.render.com
- **Railway**: Dashboard at https://railway.app
- Check logs in the deployment dashboard for errors

## Pushing Updates

After making changes:
```bash
git add .
git commit -m "Your changes"
git push
```

Both platforms auto-redeploy on git push.
